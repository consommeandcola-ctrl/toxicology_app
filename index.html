<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToxicNavi - ä¸­æ¯’è¨ºç™‚æ”¯æ´ãƒ„ãƒ¼ãƒ« ver.1.0.0 (2026/02/13 18:30)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .severity-high { background-color: #fee2e2; border-left: 4px solid #ef4444; }
        .severity-mid { background-color: #fef3c7; border-left: 4px solid #f59e0b; }
        .status-badge { @apply px-2 py-1 rounded text-xs font-bold; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-20">

    <header class="bg-slate-800 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                ğŸ§ª ToxicNavi <span class="text-sm font-normal opacity-75">ä¸­æ¯’è¨ºç™‚æ”¯æ´</span>
            </h1>
            <div class="text-xs text-right">
                æ‚£è€…ä½“é‡: <input type="number" id="patientWeight" value="60" class="bg-slate-700 border-none rounded px-2 w-16"> kg
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 max-w-4xl">
        <section class="mb-6 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold mb-4 border-b pb-2">1. æ‘‚å–è–¬å‰¤ãƒ»é‡ã®å…¥åŠ›</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="drugInput" placeholder="è–¬å‰¤å (ä¾‹: ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³)" class="border p-2 rounded">
                <input type="number" id="amountInput" placeholder="æ‘‚å–é‡ (mg)" class="border p-2 rounded">
                <button onclick="app.addDrug()" class="bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition">
                    ãƒªã‚¹ãƒˆã«è¿½åŠ 
                </button>
            </div>
        </section>

        <section class="mb-6">
            <h2 class="text-lg font-bold mb-4">2. å„ªå…ˆé †ä½ãƒ»é‡ç—‡åº¦æ¨å¯Ÿ (è‡ªå‹•ã‚½ãƒ¼ãƒˆ)</h2>
            <div id="drugList" class="space-y-3">
                <p class="text-slate-400 text-center py-10">è–¬å‰¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>
        </section>

        <section id="treatmentSection" class="hidden bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold mb-4 border-b pb-2 text-red-600">3. æ²»ç™‚å¦¥å½“æ€§ã®æ¤œè¨¼ãƒãƒˆãƒªã‚¯ã‚¹</h2>
            <div id="treatmentDetails" class="space-y-6">
                </div>
        </section>
    </main>

    <script>
        // [è¨­è¨ˆç†ç”±]: è¤‡é›‘ãªåŒ»ç™‚ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã®çŠ¶æ…‹ã‚’åŒæœŸã•ã›ã‚‹ãŸã‚ã€OOP(Class)ã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã‚’æ¡ç”¨ã€‚
        
        class ToxicNavi {
            constructor() {
                this.drugs = [];
                this.patientWeight = 60;
                // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬æ¥ã¯å¤–éƒ¨APIã‚„è†¨å¤§ãªJSONã«ã™ã‚‹ï¼‰
                this.masterData = {
                    "ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³": { comp: "Acetaminophen", toxicDose: 150, unit: "mg/kg", symptoms: "å˜”æ°—, è‚ä¸å…¨", antidote: "N-ã‚¢ã‚»ãƒãƒ«ã‚·ã‚¹ãƒ†ã‚¤ãƒ³", charcoal: true, lavage: true, dialysis: false },
                    "ã‚«ãƒ•ã‚§ã‚¤ãƒ³": { comp: "Caffeine", toxicDose: 15, unit: "mg/kg", symptoms: "é »è„ˆ, èˆˆå¥®, ä¸æ•´è„ˆ", antidote: "ãªã—(å¯¾ç—‡ç™‚æ³•)", charcoal: true, lavage: true, dialysis: true },
                    "ã‚¸ã‚¢ã‚¼ãƒ‘ãƒ ": { comp: "Diazepam", toxicDose: 0.5, unit: "mg/kg", symptoms: "æ„è­˜éšœå®³, å‘¼å¸æŠ‘åˆ¶", antidote: "ãƒ•ãƒ«ãƒã‚¼ãƒ‹ãƒ«", charcoal: true, lavage: false, dialysis: false }
                };
            }

            addDrug() {
                const name = document.getElementById('drugInput').value;
                const amount = parseFloat(document.getElementById('amountInput').value);
                this.patientWeight = parseFloat(document.getElementById('patientWeight').value);

                if (!name || !amount) return alert("å…¥åŠ›ãŒä¸å®Œå…¨ã§ã™");

                const info = this.masterData[name] || { comp: "ä¸æ˜", toxicDose: 0, symptoms: "ä¸æ˜", unknown: true };
                
                // é‡ç—‡åº¦è¨ˆç®— (æ‘‚å–é‡ / ä½“é‡)
                const dosePerKg = amount / this.patientWeight;
                const severityScore = info.toxicDose ? (dosePerKg / info.toxicDose) : 0;

                this.drugs.push({
                    name, amount, dosePerKg, info, severityScore
                });

                // é‡ç—‡åº¦é †ã«ã‚½ãƒ¼ãƒˆ
                this.drugs.sort((a, b) => b.severityScore - a.severityScore);
                
                this.render();
            }

            render() {
                const listEl = document.getElementById('drugList');
                const treatEl = document.getElementById('treatmentSection');
                const treatDetailEl = document.getElementById('treatmentDetails');
                
                listEl.innerHTML = "";
                treatDetailEl.innerHTML = "";

                if (this.drugs.length > 0) treatEl.classList.remove('hidden');

                this.drugs.forEach((drug, index) => {
                    const sevClass = drug.severityScore >= 1 ? 'severity-high' : 'severity-mid';
                    
                    // ãƒªã‚¹ãƒˆè¡¨ç¤º
                    listEl.innerHTML += `
                        <div class="${sevClass} p-4 rounded shadow-sm flex justify-between items-center bg-white">
                            <div>
                                <span class="text-xs font-bold text-slate-500">No.${index + 1} å„ªå…ˆåº¦é«˜</span>
                                <h3 class="font-bold text-lg">${drug.name} (${drug.info.comp})</h3>
                                <p class="text-sm">äºˆæ¸¬ç—‡çŠ¶: <span class="text-red-600">${drug.info.symptoms}</span></p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-black">${drug.dosePerKg.toFixed(1)}</div>
                                <div class="text-xs">mg/kg æ‘‚å–</div>
                            </div>
                        </div>
                    `;

                    // æ²»ç™‚å¦¥å½“æ€§è¡¨ç¤º
                    treatDetailEl.innerHTML += `
                        <div class="border-l-4 border-slate-800 pl-4 mb-8">
                            <h3 class="font-black text-xl mb-3 underline">${drug.name} ã®æ²»ç™‚æˆ¦ç•¥</h3>
                            <table class="w-full text-sm border-collapse">
                                <tr class="border-b">
                                    <td class="py-2 font-bold w-32">æ‹®æŠ—è–¬</td>
                                    <td class="py-2">${drug.info.antidote || 'ãªã—'}</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="py-2 font-bold text-blue-600">èƒƒæ´—æµ„</td>
                                    <td class="py-2">${drug.info.lavage ? 'âœ… è€ƒæ…®ï¼ˆæ‘‚å–1æ™‚é–“ä»¥å†…ï¼‰' : 'âŒ éæ¨å¥¨'}</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="py-2 font-bold text-green-600">æ´»æ€§ç‚­</td>
                                    <td class="py-2">${drug.info.charcoal ? 'âœ… æ¨å¥¨' : 'âš ï¸ ç¦å¿Œã¾ãŸã¯åŠ¹æœè–„'}</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="py-2 font-bold text-purple-600">è¡€æ¶²æµ„åŒ–</td>
                                    <td class="py-2">${drug.info.dialysis ? 'âœ… é©å¿œæ¤œè¨ï¼ˆé‡ç—‡æ™‚ï¼‰' : 'âŒ åŠ¹æœãªã—'}</td>
                                </tr>
                            </table>
                        </div>
                    `;
                });
            }
        }

        const app = new ToxicNavi();
    </script>
</body>
</html>
