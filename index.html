<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToxicNavi Pro - ä¸­æ¯’è¨ºç™‚æ”¯æ´ãƒ„ãƒ¼ãƒ« ver.2.0.0 (2026/02/13)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .severity-high { background-color: #fee2e2; border-left: 4px solid #ef4444; }
        .severity-mid { background-color: #fef3c7; border-left: 4px solid #f59e0b; }
        .severity-low { background-color: #dcfce7; border-left: 4px solid #22c55e; }
        .status-badge { @apply px-2 py-1 rounded text-xs font-bold; }
        .symptom-match { background-color: #fef08a; font-weight: bold; }
        .symptom-item { @apply cursor-pointer px-3 py-2 rounded border transition-all; }
        .symptom-item:hover { @apply bg-slate-100; }
        .symptom-selected { @apply bg-blue-100 border-blue-500; }
        .treatment-justified { @apply bg-green-50 border-green-300; }
        .treatment-not-justified { @apply bg-red-50 border-red-300; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-20">

    <header class="bg-gradient-to-r from-slate-800 to-slate-700 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                ğŸ§ª ToxicNavi Pro <span class="text-sm font-normal opacity-75">ä¸­æ¯’è¨ºç™‚æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  v2.0</span>
            </h1>
            <div class="text-xs text-right">
                æ‚£è€…ä½“é‡: <input type="number" id="patientWeight" value="60" class="bg-slate-700 border-none rounded px-2 w-16"> kg
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 border-b pb-2">1ï¸âƒ£ æ‘‚å–è–¬å‰¤ãƒ»é‡ã®å…¥åŠ›</h2>
                <div class="space-y-3">
                    <input type="text" id="drugInput" placeholder="è–¬å‰¤å (ä¾‹: ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³)" class="border p-2 rounded w-full">
                    <input type="number" id="amountInput" placeholder="æ‘‚å–é‡ (mg)" class="border p-2 rounded w-full">
                    <button onclick="app.addDrug()" class="bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700 transition w-full">
                        â• ãƒªã‚¹ãƒˆã«è¿½åŠ 
                    </button>
                </div>
            </section>

            <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 border-b pb-2">2ï¸âƒ£ æ‚£è€…ã®ç¾åœ¨ç—‡çŠ¶</h2>
                <div id="symptomSelector" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- ç—‡çŠ¶ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                </div>
                <button onclick="app.checkSymptomMatch()" class="mt-4 bg-purple-600 text-white font-bold py-2 px-4 rounded hover:bg-purple-700 transition w-full">
                    ğŸ” ç—‡çŠ¶ç…§åˆã‚’å®Ÿè¡Œ
                </button>
            </section>
        </div>

        <section class="mt-6">
            <h2 class="text-lg font-bold mb-4">3ï¸âƒ£ é‡ç—‡åº¦é †ãƒ»å„ªå…ˆåº¦ãƒªã‚¹ãƒˆ</h2>
            <div id="drugList" class="space-y-3">
                <p class="text-slate-400 text-center py-10">è–¬å‰¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>
        </section>

        <section id="treatmentSection" class="hidden mt-6 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold mb-4 border-b pb-2 text-red-600">4ï¸âƒ£ æ²»ç™‚å¦¥å½“æ€§ã®æ¤œè¨¼ãƒãƒˆãƒªã‚¯ã‚¹</h2>
            <div id="treatmentDetails" class="space-y-6">
            </div>
        </section>
    </main>

    <script>
        // [è¨­è¨ˆç†ç”±]: è¤‡é›‘ãªåŒ»ç™‚ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã®çŠ¶æ…‹ã‚’åŒæœŸã•ã›ã‚‹ãŸã‚ã€OOP(Class)ã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã‚’æ¡ç”¨ã€‚
        
        class ToxicNavi {
            constructor() {
                this.drugs = [];
                this.patientWeight = 60;
                this.patientSymptoms = [];
                
                // ç—‡çŠ¶ãƒã‚¹ã‚¿ãƒ¼
                this.allSymptoms = [
                    "æ„è­˜éšœå®³", "å‘¼å¸æŠ‘åˆ¶", "é »è„ˆ", "å¾è„ˆ", "é«˜è¡€åœ§", "ä½è¡€åœ§",
                    "å˜”æ°—ãƒ»å˜”å", "è…¹ç—›", "ä¸‹ç—¢", "èˆˆå¥®", "ç—™æ”£", "ãƒŸã‚ªã‚¯ãƒ­ãƒ¼ãƒŒã‚¹",
                    "ç¸®ç³", "æ•£ç³", "ç™ºæ±—", "ä¹¾ç‡¥", "ç™ºç†±", "ä½ä½“æ¸©",
                    "ä¸æ•´è„ˆ", "QTå»¶é•·", "è‚æ©Ÿèƒ½éšœå®³", "è…æ©Ÿèƒ½éšœå®³",
                    "ä»£è¬æ€§ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹", "å‘¼å¸æ€§ã‚¢ãƒ«ã‚«ãƒ­ãƒ¼ã‚·ã‚¹", "ä½è¡€ç³–", "é«˜è¡€ç³–"
                ];
                
                // ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¡å¼µç‰ˆï¼‰
                this.masterData = {
                    "ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³": {
                        comp: "Acetaminophen",
                        toxicDose: 150,
                        unit: "mg/kg",
                        symptoms: ["å˜”æ°—ãƒ»å˜”å", "è…¹ç—›", "è‚æ©Ÿèƒ½éšœå®³"],
                        antidote: "N-ã‚¢ã‚»ãƒãƒ«ã‚·ã‚¹ãƒ†ã‚¤ãƒ³",
                        antidoteReason: "è‚è‡“ã§ã®æ¯’æ€§ä»£è¬ç‰©ã‚’ä¸­å’Œ",
                        charcoal: true,
                        charcoalReason: "æ‘‚å–2æ™‚é–“ä»¥å†…ãªã‚‰50gæŠ•ä¸",
                        lavage: true,
                        lavageReason: "å¤§é‡æ‘‚å–ã‹ã¤1æ™‚é–“ä»¥å†…ã§ã‚ã‚Œã°è€ƒæ…®",
                        dialysis: false,
                        dialysisReason: "ã‚¿ãƒ³ãƒ‘ã‚¯çµåˆç‡é«˜ãç„¡åŠ¹",
                        otherTx: "è£œæ¶²ã€è‚ä¿è­·ç™‚æ³•ã€é‡ç—‡æ™‚ã¯è‚ç§»æ¤æ¤œè¨"
                    },
                    "ã‚«ãƒ•ã‚§ã‚¤ãƒ³": {
                        comp: "Caffeine",
                        toxicDose: 15,
                        unit: "mg/kg",
                        symptoms: ["é »è„ˆ", "èˆˆå¥®", "ä¸æ•´è„ˆ", "å˜”æ°—ãƒ»å˜”å", "ç—™æ”£"],
                        antidote: "ãªã—ï¼ˆÎ²é®æ–­è–¬ã§å¯¾ç—‡ç™‚æ³•ï¼‰",
                        antidoteReason: "ç‰¹ç•°çš„æ‹®æŠ—è–¬ãªã—ã€é »è„ˆã«ãƒ—ãƒ­ãƒ—ãƒ©ãƒãƒ­ãƒ¼ãƒ«è€ƒæ…®",
                        charcoal: true,
                        charcoalReason: "è…¸è‚å¾ªç’°ã™ã‚‹ãŸã‚å¤šå›æŠ•ä¸ãŒæœ‰åŠ¹",
                        lavage: true,
                        lavageReason: "1æ™‚é–“ä»¥å†…ãªã‚‰è€ƒæ…®",
                        dialysis: true,
                        dialysisReason: "é‡ç—‡ä¾‹ã§ã¯è¡€æ¶²é€æãŒæœ‰åŠ¹",
                        otherTx: "ç—™æ”£ã«ãƒ™ãƒ³ã‚¾ã‚¸ã‚¢ã‚¼ãƒ”ãƒ³ã€è£œæ¶²ã€ä¸æ•´è„ˆç®¡ç†"
                    },
                    "ã‚¸ã‚¢ã‚¼ãƒ‘ãƒ ": {
                        comp: "Diazepam",
                        toxicDose: 0.5,
                        unit: "mg/kg",
                        symptoms: ["æ„è­˜éšœå®³", "å‘¼å¸æŠ‘åˆ¶", "ä½è¡€åœ§", "å¾è„ˆ"],
                        antidote: "ãƒ•ãƒ«ãƒã‚¼ãƒ‹ãƒ«",
                        antidoteReason: "ãƒ™ãƒ³ã‚¾ã‚¸ã‚¢ã‚¼ãƒ”ãƒ³å—å®¹ä½“æ‹®æŠ—è–¬ã€0.2mgé™æ³¨",
                        charcoal: true,
                        charcoalReason: "æ‘‚å–æ—©æœŸãªã‚‰æœ‰åŠ¹",
                        lavage: false,
                        lavageReason: "èª¤åš¥ãƒªã‚¹ã‚¯é«˜ãéæ¨å¥¨",
                        dialysis: false,
                        dialysisReason: "è„‚æº¶æ€§é«˜ãé€æç„¡åŠ¹",
                        otherTx: "æ°—é“ç¢ºä¿ã€å‘¼å¸ç®¡ç†ã€è¡€åœ§ç®¡ç†"
                    },
                    "ã‚¢ã‚¹ãƒ”ãƒªãƒ³": {
                        comp: "Aspirin (Acetylsalicylic acid)",
                        toxicDose: 150,
                        unit: "mg/kg",
                        symptoms: ["å˜”æ°—ãƒ»å˜”å", "é »è„ˆ", "ç™ºæ±—", "ä»£è¬æ€§ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹", "å‘¼å¸æ€§ã‚¢ãƒ«ã‚«ãƒ­ãƒ¼ã‚·ã‚¹", "ç™ºç†±"],
                        antidote: "ãªã—ï¼ˆé‡ç‚­é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ã§å°¿ã‚¢ãƒ«ã‚«ãƒªåŒ–ï¼‰",
                        antidoteReason: "å°¿pHã‚’7.5-8.0ã«ç¶­æŒã—æ’æ³„ä¿ƒé€²",
                        charcoal: true,
                        charcoalReason: "å¤šå›æŠ•ä¸ï¼ˆ6æ™‚é–“æ¯ï¼‰ãŒæ¨å¥¨",
                        lavage: true,
                        lavageReason: "å¤§é‡æ‘‚å–1æ™‚é–“ä»¥å†…ãªã‚‰è€ƒæ…®",
                        dialysis: true,
                        dialysisReason: "è¡€ä¸­æ¿ƒåº¦>100mg/dLã€é‡ç—‡ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹ã§é©å¿œ",
                        otherTx: "è£œæ¶²ã€Kè£œæ­£ã€ãƒ“ã‚¿ãƒŸãƒ³KæŠ•ä¸"
                    },
                    "ãƒªãƒã‚¦ãƒ ": {
                        comp: "Lithium",
                        toxicDose: 1,
                        unit: "mEq/kg",
                        symptoms: ["å˜”æ°—ãƒ»å˜”å", "ä¸‹ç—¢", "æ„è­˜éšœå®³", "ç—™æ”£", "ãƒŸã‚ªã‚¯ãƒ­ãƒ¼ãƒŒã‚¹", "ä¸æ•´è„ˆ"],
                        antidote: "ãªã—",
                        antidoteReason: "ç‰¹ç•°çš„æ‹®æŠ—è–¬ãªã—",
                        charcoal: false,
                        charcoalReason: "æ´»æ€§ç‚­ã«å¸ç€ã•ã‚Œãªã„",
                        lavage: true,
                        lavageReason: "å¤§é‡æ‘‚å–ç›´å¾Œãªã‚‰è€ƒæ…®",
                        dialysis: true,
                        dialysisReason: "è¡€ä¸­æ¿ƒåº¦>4mEq/Lã¾ãŸã¯é‡ç—‡ç—‡çŠ¶ã§å¼·ãæ¨å¥¨",
                        otherTx: "ç”Ÿç†é£Ÿå¡©æ°´å¤§é‡è£œæ¶²ã€Kãƒ»Mgè£œæ­£"
                    },
                    "ä¸‰ç’°ç³»æŠ—ã†ã¤è–¬": {
                        comp: "Tricyclic antidepressants",
                        toxicDose: 10,
                        unit: "mg/kg",
                        symptoms: ["æ„è­˜éšœå®³", "ç—™æ”£", "ä¸æ•´è„ˆ", "QTå»¶é•·", "æ•£ç³", "ä¹¾ç‡¥", "ä½è¡€åœ§"],
                        antidote: "ç‚­é…¸æ°´ç´ ãƒŠãƒˆãƒªã‚¦ãƒ ",
                        antidoteReason: "QRSå¹…å»¶é•·ã«å¯¾ã—è¡€æ¶²ã‚¢ãƒ«ã‚«ãƒªåŒ–ï¼ˆpH7.45-7.55ï¼‰",
                        charcoal: true,
                        charcoalReason: "å¤šå›æŠ•ä¸æ¨å¥¨ï¼ˆè…¸è‚å¾ªç’°ã‚ã‚Šï¼‰",
                        lavage: false,
                        lavageReason: "æ„è­˜éšœå®³ãƒªã‚¹ã‚¯ã§éæ¨å¥¨",
                        dialysis: false,
                        dialysisReason: "åˆ†å¸ƒå®¹ç©å¤§ããç„¡åŠ¹",
                        otherTx: "ç—™æ”£ã«ãƒ™ãƒ³ã‚¾ã‚¸ã‚¢ã‚¼ãƒ”ãƒ³ã€ä¸æ•´è„ˆç®¡ç†ã€æ˜‡åœ§å‰¤"
                    },
                    "ãƒ‘ãƒ©ã‚³ãƒ¼ãƒˆ": {
                        comp: "Paraquat",
                        toxicDose: 20,
                        unit: "mg/kg",
                        symptoms: ["å˜”æ°—ãƒ»å˜”å", "è…¹ç—›", "è‚æ©Ÿèƒ½éšœå®³", "è…æ©Ÿèƒ½éšœå®³", "å‘¼å¸æŠ‘åˆ¶"],
                        antidote: "ãªã—",
                        antidoteReason: "ç‰¹ç•°çš„æ‹®æŠ—è–¬ãªã—ã€æŠ—é…¸åŒ–ç™‚æ³•ã¯è­°è«–ã‚ã‚Š",
                        charcoal: true,
                        charcoalReason: "æ—©æœŸå¤§é‡æŠ•ä¸ï¼ˆ100gä»¥ä¸Šï¼‰ãŒé‡è¦",
                        lavage: true,
                        lavageReason: "æ‘‚å–ç›´å¾Œã¯ç©æ¥µçš„ã«æ–½è¡Œ",
                        dialysis: true,
                        dialysisReason: "æ—©æœŸã®è¡€æ¶²æµ„åŒ–ãŒäºˆå¾Œæ”¹å–„ã«å¯„ä¸ã™ã‚‹å¯èƒ½æ€§",
                        otherTx: "é…¸ç´ æŠ•ä¸ã¯æœ€å°é™ã€å…ç–«æŠ‘åˆ¶ç™‚æ³•ã€è‚ºç§»æ¤æ¤œè¨"
                    },
                    "ãƒ¡ã‚¿ãƒãƒ¼ãƒ«": {
                        comp: "Methanol",
                        toxicDose: 0.3,
                        unit: "mL/kg",
                        symptoms: ["æ„è­˜éšœå®³", "ä»£è¬æ€§ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹", "æ•£ç³", "ç™ºæ±—"],
                        antidote: "ã‚¨ã‚¿ãƒãƒ¼ãƒ«ã¾ãŸã¯ãƒ›ãƒ¡ãƒ”ã‚¾ãƒ¼ãƒ«",
                        antidoteReason: "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«è„±æ°´ç´ é…µç´ ã‚’ç«¶åˆé˜»å®³ã—æ¯’æ€§ä»£è¬ç‰©ç”Ÿæˆã‚’æŠ‘åˆ¶",
                        charcoal: false,
                        charcoalReason: "ä½åˆ†å­ã§å¸ç€ã•ã‚Œãªã„",
                        lavage: false,
                        lavageReason: "æ®ç™ºæ€§ã§åŠ¹æœè–„ã„",
                        dialysis: true,
                        dialysisReason: "è¡€ä¸­æ¿ƒåº¦>50mg/dLã¾ãŸã¯ä»£è¬æ€§ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹ã§å¼·ãæ¨å¥¨",
                        otherTx: "é‡ç‚­é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ã€è‘‰é…¸æŠ•ä¸"
                    },
                    "ã‚¸ã‚®ã‚¿ãƒªã‚¹": {
                        comp: "Digoxin",
                        toxicDose: 0.05,
                        unit: "mg/kg",
                        symptoms: ["å˜”æ°—ãƒ»å˜”å", "ä¸æ•´è„ˆ", "å¾è„ˆ", "é«˜è¡€ç³–"],
                        antidote: "ã‚¸ã‚´ã‚­ã‚·ãƒ³ç‰¹ç•°çš„æŠ—ä½“",
                        antidoteReason: "è¡€ä¸­ã‚¸ã‚´ã‚­ã‚·ãƒ³ã‚’ä¸­å’Œã€ç”Ÿå‘½å±æ©Ÿçš„ä¸æ•´è„ˆã«æŠ•ä¸",
                        charcoal: true,
                        charcoalReason: "å¤šå›æŠ•ä¸ãŒæœ‰åŠ¹ï¼ˆè…¸è‚å¾ªç’°ã‚ã‚Šï¼‰",
                        lavage: false,
                        lavageReason: "è¿·èµ°ç¥çµŒåˆºæ¿€ã§ä¸æ•´è„ˆèª˜ç™ºãƒªã‚¹ã‚¯",
                        dialysis: false,
                        dialysisReason: "åˆ†å¸ƒå®¹ç©å¤§ããç„¡åŠ¹",
                        otherTx: "Kè£œæ­£ï¼ˆä½Kã§æ¯’æ€§å¢—å¼·ï¼‰ã€ãƒšãƒ¼ã‚·ãƒ³ã‚°"
                    },
                    "ã‚·ã‚¢ãƒ³åŒ–ç‰©": {
                        comp: "Cyanide",
                        toxicDose: 1,
                        unit: "mg/kg",
                        symptoms: ["æ„è­˜éšœå®³", "å‘¼å¸æŠ‘åˆ¶", "ç—™æ”£", "ä»£è¬æ€§ã‚¢ã‚·ãƒ‰ãƒ¼ã‚·ã‚¹", "ä½è¡€åœ§"],
                        antidote: "ãƒ’ãƒ‰ãƒ­ã‚­ã‚½ã‚³ãƒãƒ©ãƒŸãƒ³ã€ãƒã‚ªç¡«é…¸ãƒŠãƒˆãƒªã‚¦ãƒ ",
                        antidoteReason: "ã‚·ã‚¢ãƒ³ã‚’çµåˆãƒ»ç„¡æ¯’åŒ–ã€ãƒ’ãƒ‰ãƒ­ã‚­ã‚½ã‚³ãƒãƒ©ãƒŸãƒ³5gé™æ³¨",
                        charcoal: false,
                        charcoalReason: "å³åº§ã«å¸åã•ã‚Œã‚‹ãŸã‚ç„¡åŠ¹",
                        lavage: false,
                        lavageReason: "æ™‚é–“çš„ä½™è£•ãªã—",
                        dialysis: false,
                        dialysisReason: "ä½œç”¨è¿…é€Ÿã§é€æé–“ã«åˆã‚ãš",
                        otherTx: "100%é…¸ç´ æŠ•ä¸ã€äºœç¡é…¸ã‚¢ãƒŸãƒ«å¸å…¥ã€è£œæ¶²"
                    }
                };
                
                this.renderSymptomSelector();
            }

            renderSymptomSelector() {
                const selector = document.getElementById('symptomSelector');
                selector.innerHTML = this.allSymptoms.map(s => `
                    <div class="symptom-item" onclick="app.toggleSymptom('${s}')">
                        <input type="checkbox" id="sym_${s}" class="mr-2">
                        <label for="sym_${s}" class="cursor-pointer">${s}</label>
                    </div>
                `).join('');
            }

            toggleSymptom(symptom) {
                const checkbox = document.getElementById(`sym_${symptom}`);
                if (this.patientSymptoms.includes(symptom)) {
                    this.patientSymptoms = this.patientSymptoms.filter(s => s !== symptom);
                    checkbox.checked = false;
                    checkbox.parentElement.classList.remove('symptom-selected');
                } else {
                    this.patientSymptoms.push(symptom);
                    checkbox.checked = true;
                    checkbox.parentElement.classList.add('symptom-selected');
                }
            }

            addDrug() {
                const name = document.getElementById('drugInput').value;
                const amount = parseFloat(document.getElementById('amountInput').value);
                this.patientWeight = parseFloat(document.getElementById('patientWeight').value);

                if (!name || !amount) return alert("è–¬å‰¤åã¨æ‘‚å–é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

                const info = this.masterData[name];
                
                if (!info) {
                    alert(`ã€Œ${name}ã€ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nç™»éŒ²è–¬å‰¤:\n` + Object.keys(this.masterData).join(', '));
                    return;
                }
                
                // é‡ç—‡åº¦è¨ˆç®—
                const dosePerKg = amount / this.patientWeight;
                const severityScore = info.toxicDose ? (dosePerKg / info.toxicDose) : 0;

                this.drugs.push({
                    name, amount, dosePerKg, info, severityScore
                });

                // é‡ç—‡åº¦é †ã«ã‚½ãƒ¼ãƒˆ
                this.drugs.sort((a, b) => b.severityScore - a.severityScore);
                
                document.getElementById('drugInput').value = '';
                document.getElementById('amountInput').value = '';
                
                this.render();
            }

            checkSymptomMatch() {
                if (this.patientSymptoms.length === 0) {
                    alert('æ‚£è€…ã®ç—‡çŠ¶ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                this.render();
            }

            render() {
                const listEl = document.getElementById('drugList');
                const treatEl = document.getElementById('treatmentSection');
                const treatDetailEl = document.getElementById('treatmentDetails');
                
                listEl.innerHTML = "";
                treatDetailEl.innerHTML = "";

                if (this.drugs.length === 0) {
                    listEl.innerHTML = '<p class="text-slate-400 text-center py-10">è–¬å‰¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>';
                    return;
                }

                treatEl.classList.remove('hidden');

                this.drugs.forEach((drug, index) => {
                    let sevClass = 'severity-low';
                    let sevLabel = 'ä½ãƒªã‚¹ã‚¯';
                    if (drug.severityScore >= 2) {
                        sevClass = 'severity-high';
                        sevLabel = 'é«˜ãƒªã‚¹ã‚¯ - ç·Šæ€¥å¯¾å¿œ';
                    } else if (drug.severityScore >= 1) {
                        sevClass = 'severity-high';
                        sevLabel = 'ä¸­æ¯’é‡';
                    } else if (drug.severityScore >= 0.5) {
                        sevClass = 'severity-mid';
                        sevLabel = 'è­¦æˆ’é‡';
                    }
                    
                    // ç—‡çŠ¶ç…§åˆ
                    const matchedSymptoms = drug.info.symptoms.filter(s => this.patientSymptoms.includes(s));
                    const matchRate = drug.info.symptoms.length > 0 
                        ? Math.round((matchedSymptoms.length / drug.info.symptoms.length) * 100) 
                        : 0;
                    
                    // ãƒªã‚¹ãƒˆè¡¨ç¤º
                    listEl.innerHTML += `
                        <div class="${sevClass} p-4 rounded shadow-sm bg-white">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-xs font-bold bg-slate-800 text-white px-2 py-1 rounded">No.${index + 1}</span>
                                        <span class="text-xs font-bold text-red-600">${sevLabel}</span>
                                    </div>
                                    <h3 class="font-bold text-xl mb-1">${drug.name}</h3>
                                    <p class="text-sm text-slate-600 mb-2">æˆåˆ†: ${drug.info.comp}</p>
                                    <p class="text-sm mb-2">
                                        <span class="font-bold">äºˆæ¸¬ç—‡çŠ¶:</span>
                                        ${drug.info.symptoms.map(s => {
                                            const matched = this.patientSymptoms.includes(s);
                                            return matched 
                                                ? `<span class="symptom-match px-1">${s}</span>`
                                                : `<span>${s}</span>`;
                                        }).join(', ')}
                                    </p>
                                    ${matchRate > 0 ? `
                                        <div class="bg-yellow-100 border border-yellow-400 rounded px-2 py-1 text-xs mt-2">
                                            âš ï¸ ç—‡çŠ¶ä¸€è‡´ç‡: ${matchRate}% (${matchedSymptoms.length}/${drug.info.symptoms.length}é …ç›®)
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="text-right ml-4">
                                    <div class="text-3xl font-black">${drug.dosePerKg.toFixed(1)}</div>
                                    <div class="text-xs">mg/kg</div>
                                    <div class="text-xs text-slate-500 mt-1">ä¸­æ¯’é‡: ${drug.info.toxicDose} ${drug.info.unit}</div>
                                    <div class="text-xs font-bold mt-2 ${drug.severityScore >= 1 ? 'text-red-600' : 'text-green-600'}">
                                        ${(drug.severityScore * 100).toFixed(0)}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                    // æ²»ç™‚å¦¥å½“æ€§è¡¨ç¤º
                    treatDetailEl.innerHTML += `
                        <div class="border-2 rounded-lg p-6 ${sevClass}">
                            <h3 class="font-black text-2xl mb-4 flex items-center gap-2">
                                <span class="bg-slate-800 text-white px-3 py-1 rounded text-sm">${index + 1}</span>
                                ${drug.name} ã®æ²»ç™‚æˆ¦ç•¥
                            </h3>
                            
                            <div class="grid grid-cols-1 gap-4">
                                <!-- æ‹®æŠ—è–¬ -->
                                <div class="bg-white border-2 rounded p-4 ${drug.info.antidote !== 'ãªã—' && !drug.info.antidote.includes('ãªã—') ? 'treatment-justified' : ''}">
                                    <div class="flex items-start gap-2">
                                        <div class="font-bold text-lg min-w-32">ğŸ’Š æ‹®æŠ—è–¬</div>
                                        <div class="flex-1">
                                            <div class="font-bold mb-1">${drug.info.antidote}</div>
                                            <div class="text-sm text-slate-600">${drug.info.antidoteReason}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- èƒƒæ´—æµ„ -->
                                <div class="bg-white border-2 rounded p-4 ${drug.info.lavage ? 'treatment-justified' : 'treatment-not-justified'}">
                                    <div class="flex items-start gap-2">
                                        <div class="font-bold text-lg min-w-32">ğŸš¿ èƒƒæ´—æµ„</div>
                                        <div class="flex-1">
                                            <div class="font-bold mb-1">${drug.info.lavage ? 'âœ… é©å¿œã‚ã‚Š' : 'âŒ éæ¨å¥¨'}</div>
                                            <div class="text-sm text-slate-600">${drug.info.lavageReason}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- æ´»æ€§ç‚­ -->
                                <div class="bg-white border-2 rounded p-4 ${drug.info.charcoal ? 'treatment-justified' : 'treatment-not-justified'}">
                                    <div class="flex items-start gap-2">
                                        <div class="font-bold text-lg min-w-32">âš« æ´»æ€§ç‚­</div>
                                        <div class="flex-1">
                                            <div class="font-bold mb-1">${drug.info.charcoal ? 'âœ… æ¨å¥¨' : 'âŒ ç„¡åŠ¹'}</div>
                                            <div class="text-sm text-slate-600">${drug.info.charcoalReason}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- è¡€æ¶²æµ„åŒ– -->
                                <div class="bg-white border-2 rounded p-4 ${drug.info.dialysis ? 'treatment-justified' : 'treatment-not-justified'}">
                                    <div class="flex items-start gap-2">
                                        <div class="font-bold text-lg min-w-32">ğŸ©¸ è¡€æ¶²æµ„åŒ–</div>
                                        <div class="flex-1">
                                            <div class="font-bold mb-1">${drug.info.dialysis ? 'âœ… é©å¿œæ¤œè¨' : 'âŒ ç„¡åŠ¹'}</div>
                                            <div class="text-sm text-slate-600">${drug.info.dialysisReason}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ãã®ä»–æ²»ç™‚ -->
                                <div class="bg-blue-50 border-2 border-blue-300 rounded p-4">
                                    <div class="flex items-start gap-2">
                                        <div class="font-bold text-lg min-w-32">ğŸ¥ ãã®ä»–</div>
                                        <div class="flex-1">
                                            <div class="text-sm">${drug.info.otherTx}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
        }

        const app = new ToxicNavi();
    </script>
</body>
</html>
