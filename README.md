# ToxicNavi

中毒初期対応を支援するブラウザアプリです。  
薬剤入力（手入力 / 写真OCR）から、成分展開・重症度推定・治療妥当性判定までを行います。

## 画面表示ポリシー

以下の説明ブロックは **index.html の画面上には表示しない** 方針です。

- 診療フロー（自動化している処理）
- JPIC互換データモデルの説明カード

背景を知りたい場合のみ、この README を参照してください。

## 背景ロジック（画面非表示）

### 診療フロー（内部実装）

1. 入力薬剤名から製剤データを参照し、含有成分へ展開
2. 成分ごとの毒性閾値（mg/kg）を参照
3. 内服量と体重から摂取量（mg/kg）を算出
4. 重症度スコアで危険度順にソート
5. 予測症状と患者症状の一致を評価
6. 拮抗薬・胃洗浄・活性炭・血液浄化・その他治療の妥当性を理由付きで判定

### JPIC互換データモデル（内部実装）

- 中毒量閾値  
  注意量 / 中毒量 / 重症量 / 危機量（mg/kg）
- 中毒症状タイムライン  
  時間帯別の想定症状・赤旗所見
- 体内動態  
  Tmax / 半減期 / 分布容積 / 蛋白結合 / 代謝排泄
- 分析・解釈  
  推奨検査・測定タイミング・判定の考え方

## 出力仕様（toxnavi-report-v1）

診療録貼り付け用テキストを、`index.html` の「診療録貼り付け用 出力」で生成します。

### 出力セクション

1. 患者情報
   - 体重
   - 摂取からの時間
   - 気道確保の有無
   - 観察症状
2. 入力薬剤（製剤ベース）
   - 薬剤名
   - 推定総量（mg）
   - 入力経路（手入力 / 写真OCR）
   - 展開成分
3. 成分別重症度ランキング
   - 重症度判定
   - 推定成分量（mg）
   - 推定摂取量（mg/kg）
   - 毒性比
   - 閾値（注意/中毒/重症/危機）
   - 症状一致 / 赤旗一致
4. 治療介入妥当性
   - 拮抗薬
   - 胃洗浄
   - 活性炭
   - 血液浄化
   - その他治療
5. 推奨検査（重複除外）
6. 注記

### 操作

- 「報告書を生成」: 現在の入力・解析結果から出力を更新
- 「出力をコピー」: クリップボードへコピー（失敗時は手動コピー）

## データセット

データ収集スクリプトやPMDA由来データの詳細は `DATASET.md` を参照してください。

## OCR由来の家庭用品中毒知識（初期版）

`uploads/ocr_result_1770368005162.txt` の内容を、アプリで扱える構造化データに変換して利用します。

- ファイル: `data/ocr_household_knowledge.json`
- 生成スクリプト: `scripts/build_ocr_household_knowledge.py`
- 収載カテゴリ（初期）:
  - OCRファイル内の危険度見出しから自動抽出した収載項目（現状 80 項目）
- 反映先:
  - 成分DB (`ingredientDB`)
  - 製品名別名 (`productDB`)
  - JPIC互換プロファイル (`jpic`)

注意:
- OCR由来データは誤字や文脈欠落を含む可能性があるため、`evidence.level = ocr-reference` として保持しています。
- 臨床適用時は一次情報で必ず再確認してください。
